# Fix Colors
set -g default-terminal "xterm-256color"
set -as terminal-features ",xterm-256color:RGB"

set-option -sg escape-time 10

set -gq allow-passthrough on

set -g assume-paste-time 1

set -g base-index 1
set -g pane-base-index 1

set-option -g prefix C-a
set-option -g prefix2 none

set-option -g focus-events on

unbind r
bind r source-file ~/.config/tmux/tmux.conf

unbind %
bind | split-window -h -c "#{pane_current_path}"

unbind '"'
bind - split-window -v -c "#{pane_current_path}"

unbind v
bind v copy-mode

# resizing panes with hjkl
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5
bind -r h resize-pane -L 5

# maximize panes
bind -r m resize-pane -Z

# mouse support
set -g mouse on

# Disable activity events "{SESSION} is ready!"
set -g monitor-activity off
set -g monitor-bell off

set -g history-limit 5000

# Faster status bar
set-option -g status-interval 10

# Default shell in no_sudo
if-shell -b 'test -f "$HOME/.no_sudo_indicator"' 'set -g default-shell /bin/zsh'

# Enabling osc(remote) clipboard
set -g set-clipboard on

# vim shell navigations and selects in tmux panes
set-window-option -g mode-keys vi
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'y' send -X copy-selection

# Vào copy-mode và bắt đầu chọn bằng phím `v`
bind-key -T copy-mode-vi v send-keys -X begin-selection
# Hủy bỏ việc chọn khi nhấn `Enter`
bind-key -T copy-mode-vi Enter send-keys -X cancel
# Sao chép nội dung được chọn và gửi tới `xclip` để sao chép vào clipboard khi nhấn `y`
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'xclip -in -selection clipboard'

# Instant switch to a new tmux session directory that exist
# bind-key -r f run-shell "tmux neww ~/scripts/tmux-sessionizer"
bind-key n command-prompt "new-session -s '%%'"

# Drag copy using mouse
unbind -T copy-mode-vi MouseDragEnd1Pane


# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin "christoomey/vim-tmux-navigator"
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'robhurring/tmux-uptime'
set -g @plugin 'jaclu/tmux-menus'
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'olimorris/tmux-pomodoro-plus'

set -g @plugin 'omerxx/tmux-sessionx' # default keybind "<prefix> O" to activate
set -g @plugin "tmux-plugins/tmux-resurrect" #persist tmux sessions after computer restart
# set -g @plugin "tmux-plugins/tmux-continuum" #automatically save sessions every 15mins

# Instant switch to a new tmux session directory that exist
bind-key -r f run-shell "tmux neww ~/scripts/tmux-sessionizer"
bind-key n command-prompt "new-session -s '%%'"

set-option -g status on
set -g status-interval 2

set -g @pomodoro_mins 40                       # The duration of the Pomodoro
set -g @pomodoro_break_mins 5                  # The duration of the break after the Pomodoro completes
set -g @pomodoro_intervals 4                   # The number of intervals before a longer break is started
set -g @pomodoro_long_break_mins 15            # The duration of the long break

set -g @vim_navigator_mapping_left "C-Left C-h"  # use C-h and C-Left
set -g @vim_navigator_mapping_right "C-Right C-l"
set -g @vim_navigator_mapping_up "C-k"
set -g @vim_navigator_mapping_down "C-j"
set -g @vim_navigator_mapping_prev ""  # removes the C-\ binding
set -g @vim_navigator_prefix_mapping_clear_screen ""

# tmux config: Carbonfox-inspired color scheme

# Base palette
set -g @bg      '#1c1c1c'
set -g @bg0     '#222222'
set -g @bg1     '#2a2a2a'
set -g @bg2     '#383838'
set -g @bg3     '#4e4e4e'
set -g @bg4     '#6a6a6a'
set -g @bg5     '#8a8a8a'
set -g @bg6     '#aaaaaa'

set -g @fg      '#c8c8c8'
set -g @red     '#EE5396'
set -g @orange  '#e6c384'
set -g @yellow  '#e0af68'
set -g @green   '#25be6a'
set -g @aqua    '#7dcfff'
set -g @blue    '#78A9FF'
set -g @purple  '#BE95FF'
set -g @grey0   '#545c7e'
set -g @grey1   '#414868'
set -g @light_grey  '#636363'

set -g @statusline1 '#9ece6a'
set -g @statusline2 '#c8c8c8'
set -g @statusline3 '#f7768e'

# tmux status bar settings
set-option -g status "on"
set -g status-interval 2
set-option -g status-style fg='#{@fg}',bg='#{@bg0}'

# Windows (tabs) styling
set-window-option -g window-status-style fg='#{@grey1}',bg='#{@bg0}'
set-window-option -g window-status-activity-style 'fg=#{@yellow},bg=#{@bg0},bold'
set-window-option -g window-status-current-style fg='#{@bg0}',bg='#{@blue}',bold

# Pane borders
set-option -g pane-border-style fg='#{@bg1}'
set-option -g pane-active-border-style fg='#{@blue}'

# Command & message prompts
set-option -g message-style fg='#{@bg0}',bg='#{@orange}',bold
set-option -g message-command-style fg='#{@bg0}',bg='#{@yellow}',bold

# Clock color
set-window-option -g clock-mode-colour '#7aa2f7'

# Left status segment
set-option -g status-left-style bold
set -g status-left-length 60
set -g status-left '#[fg=#{@bg0},bg=#{@green}] #S #[fg=#{@green},bg=#{@bg0}] #{uptime} |'

# Right status segment
set-option -g status-right-style bold
set -g status-right-length 150
set -g status-right '#[fg=#{@fg},bg=#{@bg0}] C:#{cpu_percentage} R:#{ram_percentage} #[fg=#{@light_grey},bg=#{@bg0}] %Y-%m-%d %H:%M #[fg=#{@red},bg=#{@bg2}] #h '

# Window name formatting
set -g window-status-separator ''
set -g window-status-format "#[fg=#{@light_grey},bg=#{@bg0}] #I #[fg=#{@light_grey},bg=#{@bg0}]#W "
set -g window-status-current-format "#[fg=#{@bg0},bg=#{@blue}] #I #[fg=#{@bg0},bg=#{@blue}]#W "

# ---- Plugins ----
run '~/.tmux/plugins/tpm/tpm'
